var app;!function(){"use strict";app=angular.module("brush",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router","ui.bootstrap","LocalStorageModule"])}(),function(){"use strict";var r=["$stateProvider","$urlRouterProvider","localStorageServiceProvider","$httpProvider",function(r,t,e,o){r.state("login",{url:"/login",templateUrl:"ui/dashboard/partials/login/login.html",controller:"loginCtrl",controllerAs:"login"}).state("logout",{url:"/logout",controller:"logoutCtrl",controllerAs:"logout"}).state("forgotPassword",{url:"/forgotPassword",templateUrl:"ui/dashboard/partials/forgotPassword/forgotPassword.html",controller:"forgotPasswordCtrl",controllerAs:"forgotPassword"}).state("resetForgotPassword",{url:"/resetForgotPassword/:token",templateUrl:"ui/dashboard/partials/resetForgotPassword/resetForgotPassword.html",controller:"resetForgotPasswordCtrl",controllerAs:"resetForgotPassword"}).state("register",{url:"/register",templateUrl:"ui/dashboard/partials/register/register.html",controller:"registerCtrl",controllerAs:"register"}).state("dashboard",{url:"/",templateUrl:"ui/dashboard/partials/dashboard/dashboard.html",controller:"dashboardCtrl",controllerAs:"dashboard"}).state("dashboard.alerts",{url:"alerts",templateUrl:"ui/dashboard/partials/dashboard/alerts/alerts.html"}).state("dashboard.users",{url:"users",controller:"usersCtrl",controllerAs:"users",templateUrl:"ui/dashboard/partials/dashboard/users/users.html"}).state("dashboard.profile",{url:"profile",templateUrl:"ui/dashboard/partials/dashboard/profile/profile.html",controller:"profileCtrl",controllerAs:"profile"}).state("dashboard.resetPassword",{url:"resetPassword",templateUrl:"ui/dashboard/partials/dashboard/resetPassword/resetPassword.html",controller:"resetPasswordCtrl",controllerAs:"resetPassword"}).state("dashboard.api",{url:"api",templateUrl:"ui/dashboard/partials/dashboard/api/api.html"}).state("dashboard.config",{url:"config",templateUrl:"ui/dashboard/partials/dashboard/config/config.html",controller:"configCtrl",controllerAs:"config"}).state("dashboard.config.roles",{url:"/roles",templateUrl:"ui/dashboard/partials/dashboard/config/roles/roles.html",controller:"rolesCtrl",controllerAs:"roles"}).state("dashboard.healthcheck",{url:"healthcheck",templateUrl:"ui/dashboard/partials/dashboard/healthcheck/healthcheck.html",controller:"healthCheckCtrl as vm"}),t.otherwise("/login"),e.setPrefix("brush"),o.interceptors.push("tokenInjector")}];app.config(r)}(),function(){"use strict";var r=["$http","$rootScope","$state","localStorageService","$uibModalStack",function(r,t,e,o,a){t.$on("$stateChangeStart",function(r,t,s,n,l,i){"login"!==t.name&&(o.get("user")||e.go("login")),a.dismissAll()})}];app.run(r)}(),function(){"use strict";app.controller("dashboardCtrl",["commonFactory","$state",function(r,t){var e=this;e.user=r.getUser(),e.user||t.go("login")}])}(),function(){"use strict";app.controller("forgotPasswordCtrl",["api","url","constants",function(r,t,e){var o=this;o.validateAndSendMeLink=function(){var a={url:t.forgotPassword,data:{username:o.username},method:e.method.post};r.executeCall(a,function(r){o.forgotPasswordError=r.data,o.username=""},function(r){o.error=r.data})}}])}(),function(){"use strict";app.controller("loginCtrl",["api","$state","$stateParams","localStorageService","loginFactory",function(r,t,e,o,a){var s=this;s.loginError=a.logoutMessage,s.validateLogin=function(){s.error={},s.loginError=!1,r.executeCall(a.login(s),function(r){r.data.api_token?(o.set("user",r.data),t.go("dashboard")):s.loginError=r.data.message},function(r){s.error=r.data})}}])}(),function(){"use strict";app.factory("loginFactory",["constants","url",function(r,t){return{login:function(e){return{url:t.login,data:{username:e.username,password:e.password},method:r.method.post}},logout:function(){return{url:t.logout}}}}])}(),function(){"use strict";app.controller("logoutCtrl",["api","$state","loginFactory","localStorageService","constants",function(r,t,e,o,a){r.executeCall(e.logout(),function(r){e.logoutMessage=a.logoutMessages.regularLogout,o.clearAll(),t.go("login")})}])}(),function(){"use strict";app.controller("registerCtrl",["api","$state","localStorageService","constants","url",function(r,t,e,o,a){var s=this;s.validateRegister=function(t){if(s.registerError=!1,s.formData){var e={url:a.register,data:{username:s.formData.username,email:s.formData.email,password:s.formData.password,name:""},method:o.method.post};r.executeCall(e,function(r){r.data.user_id?(s.registerError={message:"User has been created.",type:"success"},s.formData={}):s.registerError=r.data},function(r){s.error=r.data})}else s.error={username:!0,email:!0,password:!0}}}])}(),function(){"use strict";app.controller("resetForgotPasswordCtrl",["$state","api","url","constants",function(r,t,e,o){var a=this;a.validateLinkAndUpdatePassword=function(){if(a.password===a.confirmpassword){var s={url:e.resetForgotPassword,data:{token:r.params.token,password:a.password},method:o.method.post};t.executeCall(s,function(r){a.resetForgotPasswordError=r.data,a.confirmpassword="",a.password},function(r){a.error=r.data})}else a.error={confirmpassword:["Password doesn't match Confirm Password."]}}}])}(),function(){"use strict";app.factory("api",["$http","constants","$state","localStorageService","loginFactory",function(r,t,e,o,a){var s=function(r){o.clearAll(),a.logoutMessage=t.logoutMessages.loggedoutDueError[r.status],e.go("login")},n=function(r,t){401===r.status?s(r):t?t(r):s(r)};return{executeCall:function(e,o,a){return e.method===t.method.post?r.post(e.url,e.data).then(o,function(r){n(r,a)}):e.method===t.method.delete?r.delete(e.url).then(o,function(r){n(r,a)}):r.get(e.url).then(o,function(r){n(r,a)})}}}])}(),function(){"use strict";app.factory("commonFactory",["api","localStorageService","url",function(r,t,e){var o=function(t,e){r.executeCall(t,e)};return{getRoles:function(r){o({url:e.reference.roles},r)},getAdminRoles:function(r){o({url:e.admin.roles},r)},getUser:function(){return t.get("user")}}}])}(),function(){"use strict";app.factory("constants",[function(){return{method:{post:"POST",delete:"DELETE",get:"GET"},logoutMessages:{regularLogout:"You have logout successfully.",loggedoutDueError:{401:"You are not authorize to access. Please contact support.",500:"System error. Please contact support.",404:"Resource not found. Please contact support."}}}}])}(),function(){"use strict";app.factory("tokenInjector",["localStorageService",function(r){return{request:function(t){return r.get("user")&&(t.headers.apitoken=r.get("user").api_token),t}}}])}(),function(){"use strict";app.factory("url",[function(){return{login:"/api/login",logout:"/api/logout",register:"/api/register",forgotPassword:"/api/forgotPassword",resetForgotPassword:"/api/resetPassword",reference:{roles:"/api/reference/roles"},admin:{addUser:"/api/admin/addUser",users:"/api/admin/users",user:"/api/admin/user/",updateUser:"/api/admin/updateUser",apiHealthCheck:"/api/healthCheck/apiCheck",dbHealthCheck:"/api/healthCheck/dbCheck",roles:"api/admin/roles"},user:{me:"/api/user/me",resetPassword:"/api/user/resetPassword"}}}])}(),function(){"use strict";app.controller("configCtrl",["$scope",function(r){}])}(),function(){"use strict";app.controller("healthCheckCtrl",["api","localStorageService","healthCheckFactory",function(r,t,e){var o=this;o.api=e.initial,o.db=e.initial,o.ls=e.initial,r.executeCall(e.apiCheckConfig,function(r){o.api=e.success},function(){o.api=e.failed}),r.executeCall(e.dbCheckConfig,function(r){o.db=e.success,r.data.api_token===t.get("user").api_token?o.ls=e.success:o.ls=e.failed},function(){o.db=e.failed,o.ls=e.failed})}])}(),function(){"use strict";app.factory("healthCheckFactory",["url",function(r){return{initial:{checkValue:0,checkMessage:"checking ...",type:"warning"},success:{checkValue:100,checkMessage:"Healthy",checkPass:!0,type:"success"},failed:{checkValue:100,checkMessage:"Failed",type:"danger"},apiCheckConfig:{url:r.admin.apiHealthCheck},dbCheckConfig:{url:r.admin.dbHealthCheck}}}])}(),function(){"use strict";app.controller("resetPasswordCtrl",["api","constants","url",function(r,t,e){var o=this;o.validateAndSave=function(){if(o.error={},o.formData)if(o.formData.newPassword&&""!==o.formData.newPassword&&o.formData.newPassword===o.formData.confirmPassword){var a={url:e.user.resetPassword,method:t.method.post,data:o.formData};r.executeCall(a,function(r){o.resetPasswordError=r.data,"success"===o.resetPasswordError.type?o.formData={}:o.error.password=!0},function(r){o.error=r.data})}else o.error={newPassword:!0,confirmPassword:!0};else o.error={password:!0,newPassword:!0,confirmPassword:!0}}}])}(),function(){"use strict";app.controller("profileCtrl",["api","constants","commonFactory","url","localStorageService",function(r,t,e,o,a){var s=this,n={url:o.user.me};r.executeCall(n,function(r){s.user=r.data}),s.validateAndSave=function(){n.method=t.method.post,n.data=s.user,r.executeCall(n,function(r){r.data.user_id&&(a.set("user",r.data),s.profileError={type:"success",message:"Profile updated successfully."})},function(r){s.error=r.data})}}])}(),function(){"use strict";app.controller("usersCtrl",["api","constants","$uibModal","url",function(r,t,e,o){var a=this,s={url:o.admin.users};r.executeCall(s,function(r){a.users=r.data}),a.deleteUser=function(e){e.deleteInitiated=!0;var a={url:o.admin.user+e.user_id,method:t.method.delete};r.executeCall(a,function(r){"success"===r.data.type&&(e.deleted="Y")})},a.editUser=function(r){e.open({templateUrl:"ui/dashboard/partials/dashboard/users/addEditUser/addEditUser.html",controller:"addEditUserCtrl",controllerAs:"addEditUser",resolve:{config:function(){return r?{title:"Edit User",user:r,type:"edit"}:{title:"Add User",type:"add"}}}}).result.then(function(r){"add"===r.config.type&&a.users.push(r.user)},function(){})}}])}(),function(){"use strict";app.directive("logo",function(){return{restrict:"EA",template:'<span>bru</span><span style="color:#F39C12">sh</span>'}})}(),function(){"use strict";app.controller("rolesCtrl",["api","commonFactory",function(r,t){var e=this;t.getAdminRoles(function(r){e.roles=r.data})}])}(),function(){"use strict";app.controller("addEditUserCtrl",["$uibModalInstance","api","constants","commonFactory","config","url",function(r,t,e,o,a,s){var n=this;o.getRoles(function(r){n.roles=r.data}),n.config=a,n.user=a.user;var l={url:s.admin.updateUser};n.validateAndSave=function(){"add"===n.config.type&&(l.url=s.admin.addUser),l.method=e.method.post,l.data=n.user,t.executeCall(l,function(t){t.data.user_id?(n.user=t.data,r.close(n)):n.addEditUserError=t.data},function(r){n.error=r.data})},n.cancel=function(){r.dismiss("cancel")}}])}();